{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/duncanmiller/Documents/ICD10%20Look-up/src/app/api/search/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function POST(request: Request) {\n    try {\n        const { codes } = await request.json();\n\n        if (!Array.isArray(codes) || codes.length === 0) {\n            return NextResponse.json({ results: [] });\n        }\n\n        // 1. Fetch Codes\n        const foundCodes = await prisma.iCD10Code.findMany({\n            where: {\n                code: {\n                    in: codes,\n                },\n            },\n        });\n\n        // 2. Fetch PMB Links (where our codes are either dagger or asterisk)\n        const pmbLinks = await prisma.pMBLink.findMany({\n            where: {\n                OR: [\n                    { daggerCode: { in: codes } },\n                    { asteriskCode: { in: codes } },\n                ],\n            },\n        });\n\n        // 3. Map outcomes\n        // We want to return a result for EACH unique requested code found, \n        // plus any 'extra' context from PMB links if relevant.\n        // Or just return the list of found codes enriched with PMB data.\n\n        const results = foundCodes.map((code) => {\n            // Find related PMB links\n            const relatedLinks = pmbLinks.filter(\n                (link) => link.daggerCode === code.code || link.asteriskCode === code.code\n            );\n\n            return {\n                ...code,\n                pmbLinks: relatedLinks,\n            };\n        });\n\n        return NextResponse.json({ results });\n    } catch (error) {\n        console.error('Search error:', error);\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,sMAAY;AAExB,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU,MAAM,MAAM,KAAK,GAAG;YAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,EAAE;YAAC;QAC3C;QAEA,iBAAiB;QACjB,MAAM,aAAa,MAAM,OAAO,SAAS,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBACH,MAAM;oBACF,IAAI;gBACR;YACJ;QACJ;QAEA,qEAAqE;QACrE,MAAM,WAAW,MAAM,OAAO,OAAO,CAAC,QAAQ,CAAC;YAC3C,OAAO;gBACH,IAAI;oBACA;wBAAE,YAAY;4BAAE,IAAI;wBAAM;oBAAE;oBAC5B;wBAAE,cAAc;4BAAE,IAAI;wBAAM;oBAAE;iBACjC;YACL;QACJ;QAEA,kBAAkB;QAClB,oEAAoE;QACpE,uDAAuD;QACvD,iEAAiE;QAEjE,MAAM,UAAU,WAAW,GAAG,CAAC,CAAC;YAC5B,yBAAyB;YACzB,MAAM,eAAe,SAAS,MAAM,CAChC,CAAC,OAAS,KAAK,UAAU,KAAK,KAAK,IAAI,IAAI,KAAK,YAAY,KAAK,KAAK,IAAI;YAG9E,OAAO;gBACH,GAAG,IAAI;gBACP,UAAU;YACd;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACvC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}